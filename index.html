<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Drippy Rubix Cube Challenge</title>
  <meta name="color-scheme" content="dark" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body { height: 100%; background: #0a0f14; }
    body { margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji"; color: #fff; }
    /* helpers */
    @keyframes floaty {0%{transform:translateY(0)}50%{transform:translateY(-6px)}100%{transform:translateY(0)}}
    @keyframes wobble {0%,100%{transform:rotate(0)}25%{transform:rotate(-3deg)}75%{transform:rotate(3deg)}}
    @keyframes marquee {0%{transform:translateX(0)}100%{transform:translateX(-50%)}}
    .animate-floaty{animation:floaty 4s ease-in-out infinite}
    .animate-wobble:hover{animation:wobble .6s ease-in-out}
    .animate-marquee{animation:marquee 16s linear infinite}
    /* background drift */
    @keyframes driftNode { 0% { transform: translate3d(0,0,0) rotate(0deg) }
      50% { transform: translate3d(var(--dx), var(--dy), 0) rotate(5deg) }
      100% { transform: translate3d(0,0,0) rotate(0deg) } }
  </style>
</head>
<body>
  <!-- background -->
  <div id="bg" class="pointer-events-none absolute inset-0 overflow-hidden" aria-hidden="true"></div>

  <div class="relative min-h-screen" style="background: linear-gradient(180deg,#020409,#0a0f14 40%,#0b0e12)">
    <header class="relative">
      <div class="mx-auto max-w-6xl px-4 pt-10 pb-6">
        <div class="flex items-center gap-3">
          <img src="https://cdn.shopify.com/s/files/1/0630/6889/7494/files/eyes-3inch-red.png?v=1742844664"
               alt="Drippy Logo" class="w-12 h-12 object-contain animate-floaty animate-wobble" />
          <h1 class="text-2xl md:text-3xl font-extrabold tracking-tight bg-gradient-to-r from-lime-300 via-white to-pink-300 bg-clip-text text-transparent">
            Drippy Rubix Cube Leaderboard
          </h1>
        </div>
        <div class="mt-4 flex flex-wrap items-center gap-2">
          <span class="select-none rounded-xl bg-white/10 border border-white/10 px-3 py-1 text-xs font-semibold backdrop-blur">ðŸš€ SF startup polish</span>
          <span class="select-none rounded-xl bg-white/10 border border-white/10 px-3 py-1 text-xs font-semibold backdrop-blur">ðŸ’š Lime Ã— ðŸ’– Pink</span>
          <span class="select-none rounded-xl bg-white/10 border border-white/10 px-3 py-1 text-xs font-semibold backdrop-blur">ðŸ§© Speedrun vibes</span>
        </div>
        <p class="mt-3 max-w-2xl text-white/75">
          Sip, solve, send it. Post your best time and link your video from Instagram, TikTok, or X (Twitter).
          Fastest solves float to the topâ€”like fizz.
        </p>
      </div>
      <div class="mx-auto max-w-6xl px-4 pb-6">
        <div class="relative overflow-hidden rounded-2xl border border-white/10 bg-white/5">
          <div class="animate-marquee whitespace-nowrap py-2 text-sm">
            <span class="mx-6">ðŸ’š Lime x ðŸ’– Pink</span>
            <span class="mx-6">ðŸ§© Solve Fast</span>
            <span class="mx-6">ðŸ§  Smart Sips</span>
            <span class="mx-6">ðŸŽ¥ Link Your Clip</span>
            <span class="mx-6">ðŸš€ SF Startup Vibes</span>
          </div>
        </div>
      </div>
    </header>

    <main class="mx-auto max-w-6xl px-4 pb-24">
      <section class="grid grid-cols-1 lg:grid-cols-5 gap-6 items-stretch">
        <!-- Leaderboard -->
        <div class="lg:col-span-3 p-4 md:p-6 rounded-3xl bg-white/[0.04] backdrop-blur border border-white/10 shadow-[0_10px_40px_rgba(34,197,94,0.15)]">
          <div class="flex items-center justify-between">
            <h2 class="text-xl font-semibold">Top Times</h2>
            <span class="text-xs text-white/50">auto-sorted â€¢ lower is better</span>
          </div>
          <ol id="lbList" class="mt-4 divide-y divide-white/10"></ol>
        </div>

        <!-- Featured -->
        <div class="lg:col-span-2 p-4 md:p-6 rounded-3xl bg-white/[0.04] backdrop-blur border border-white/10 relative overflow-hidden">
          <div class="absolute -top-10 -right-10 w-40 h-40 rounded-full bg-gradient-to-tr from-lime-400/30 to-pink-500/30 blur-2xl"></div>
          <h2 class="text-xl font-semibold">Featured Clip</h2>
          <div class="mt-4 aspect-video w-full rounded-2xl overflow-hidden border border-white/10 bg-black/40" id="featuredEmbed">
            <div class="w-full h-full flex items-center justify-center text-white/60">No submission selected</div>
          </div>
          <div id="featuredMeta" class="mt-3 hidden items-center justify-between gap-2">
            <div class="min-w-0">
              <p id="featuredName" class="text-sm font-medium truncate"></p>
              <p id="featuredLink" class="text-xs text-white/60 truncate"></p>
            </div>
            <span id="featuredTime" class="text-sm font-mono tabular-nums bg-white/10 px-2 py-1 rounded-md"></span>
          </div>
        </div>
      </section>

      <!-- Submission -->
      <section id="submit" class="mt-10 p-4 md:p-6 rounded-3xl bg-white/[0.04] backdrop-blur border border-white/10 relative">
        <div class="flex items-center justify-between">
          <h3 class="text-lg md:text-xl font-semibold">Submit Your Time</h3>
          <span class="text-xs text-white/60">Demo stores locally</span>
        </div>
        <form id="submitForm" class="mt-5 grid grid-cols-1 md:grid-cols-12 gap-4">
          <div class="md:col-span-3">
            <label class="block text-sm text-white/70 mb-1">Name</label>
            <input id="name" placeholder="Your name" class="w-full rounded-xl bg-white/10 border border-white/10 px-3 py-2 outline-none focus:ring-2 focus:ring-lime-400/60" />
          </div>
          <div class="md:col-span-3">
            <label class="block text-sm text-white/70 mb-1">Time</label>
            <input id="time" placeholder="mm:ss.fff or seconds" class="w-full rounded-xl bg-white/10 border border-white/10 px-3 py-2 outline-none focus:ring-2 focus:ring-lime-400/60 font-mono" />
          </div>
          <div class="md:col-span-6">
            <label class="block text-sm text-white/70 mb-1">Video Link (Instagram, TikTok, X, YouTube, Vimeo, or .mp4)</label>
            <input id="link" placeholder="https://instagram.com/..." class="w-full rounded-xl bg-white/10 border border-white/10 px-3 py-2 outline-none focus:ring-2 focus:ring-lime-400/60" />
          </div>
          <div class="md:col-span-12 flex flex-wrap items-center gap-3">
            <button type="submit" class="rounded-xl px-5 py-2.5 font-semibold bg-gradient-to-r from-lime-400 via-emerald-400 to-pink-500 shadow-[0_10px_30px_rgba(132,204,22,0.35)] hover:scale-[1.02] hover:shadow-[0_12px_36px_rgba(236,72,153,0.45)] transition">Submit</button>
            <span class="text-xs text-white/60">By posting, you agree we can display your name + link.</span>
          </div>
        </form>
        <p class="mt-4 text-xs text-white/60">
          Pro tip: paste raw seconds like <span class="font-mono">41.82</span> or formatted like <span class="font-mono">01:02.450</span>.
          We auto-embed YouTube/Vimeo; socials open in a new tab.
        </p>
      </section>

      <footer class="relative mt-12 py-10">
        <div class="mx-auto max-w-6xl px-4">
          <div class="rounded-3xl border border-white/10 bg-white/[0.04] backdrop-blur p-6 flex flex-col md:flex-row items-center justify-between gap-4 overflow-hidden">
            <div>
              <h4 class="text-lg font-semibold">Wire it up like a real SAAS?</h4>
              <p class="text-white/70 text-sm mt-1 max-w-xl">I can push this to a Google Sheet or your backend for real submissions, add admin moderation, and build an API for embeds.</p>
            </div>
            <a href="#submit" class="rounded-2xl px-5 py-2.5 font-semibold bg-gradient-to-r from-lime-400 via-emerald-400 to-pink-500 shadow-[0_10px_30px_rgba(132,204,22,0.35)] hover:opacity-95">Start Now</a>
          </div>
        </div>
      </footer>
    </main>
  </div>

  <noscript>This app needs JavaScript enabled.</noscript>

  <script>
    // ---------- Util ----------
    const pad = (n, len=2) => String(n).padStart(len, "0");
    function parseTimeToMs(str) {
      if (!str) return Number.POSITIVE_INFINITY;
      const s = String(str).trim();
      if (/^\\d+(\\.\\d+)?$/.test(s)) return Math.round(parseFloat(s) * 1000);
      const parts = s.split(":").map(Number);
      if (parts.some((p) => isNaN(p))) return Number.POSITIVE_INFINITY;
      if (parts.length === 2) {
        const [mm, secRaw] = parts;
        const [ss, frac] = String(secRaw).split(".");
        return (mm * 60 + Number(ss)) * 1000 + (frac ? Math.round(Number("0."+frac) * 1000) : 0);
      }
      if (parts.length === 3) {
        const [hh, mm, ss] = parts;
        return ((hh * 3600) + (mm * 60) + ss) * 1000;
      }
      return Number.POSITIVE_INFINITY;
    }
    function formatMs(ms) {
      if (!isFinite(ms) || ms < 0) return "--:--";
      const totalSec = Math.floor(ms / 1000);
      const msec = ms % 1000;
      const mm = Math.floor(totalSec / 60);
      const ss = totalSec % 60;
      return \`\${pad(mm)}:\${pad(ss)}.\${pad(msec, 3)}\`;
    }
    function hostOf(url) {
      try { return new URL(url).hostname.replace("www.",""); } catch { return ""; }
    }

    // ---------- Data ----------
    const STORAGE_KEY = "drippy_rubix_entries";
    const seed = [
      { name: "Nova",      timeInput: "00:43.127", link: "https://youtu.be/dQw4w9WgXcQ" },
      { name: "Ry L.",     timeInput: "41.8",      link: "https://www.instagram.com/" },
      { name: "PixelPete", timeInput: "01:02.45",  link: "https://www.tiktok.com/" },
    ];
    function loadEntries() {
      try { const raw = localStorage.getItem(STORAGE_KEY); if (raw) return JSON.parse(raw); } catch {}
      return seed;
    }
    function saveEntries(list) {
      try { localStorage.setItem(STORAGE_KEY, JSON.stringify(list)); } catch {}
    }

    // ---------- Background (SVG nodes + lines) ----------
    function initNodeNetBG() {
      const bg = document.getElementById("bg");
      bg.innerHTML = ""; // clear
      const w = window.innerWidth || 1280, h = window.innerHeight || 720;

      // deterministic RNG for a stable layout per size
      let seed = (w ^ h ^ 1337) >>> 0;
      function rnd() {
        seed += 0x6D2B79F5;
        let t = seed;
        t = Math.imul(t ^ (t >>> 15), t | 1);
        t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
        return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
      }

      const count = Math.max(70, Math.min(140, Math.floor((w * h) / 28000)));
      const nodes = [];
      for (let i=0;i<count;i++) {
        const s = 3 + Math.floor(rnd() * 14);
        const x = Math.floor(rnd() * w);
        const y = Math.floor(rnd() * h);
        const delay = rnd() * 1.8;
        const dur = 6 + rnd() * 10;
        const dir = rnd() * 360;
        const dx = Math.cos(dir * Math.PI/180) * (6 + rnd()*16);
        const dy = Math.sin(dir * Math.PI/180) * (6 + rnd()*16);
        nodes.push({x,y,s,delay,dur,dx,dy});
      }

      const edges = [];
      const threshold = 150;
      for (let i=0;i<nodes.length;i++) for (let j=i+1;j<nodes.length;j++) {
        const a=nodes[i], b=nodes[j];
        const dx=a.x-b.x, dy=a.y-b.y;
        const d=Math.hypot(dx,dy);
        if (d<=threshold) edges.push({x1:a.x,y1:a.y,x2:b.x,y2:b.y,d});
      }

      const svg = document.createElementNS("http://www.w3.org/2000/svg","svg");
      svg.setAttribute("viewBox", \`0 0 \${w} \${h}\`);
      svg.setAttribute("preserveAspectRatio","none");
      svg.setAttribute("class","w-full h-full");
      svg.style.opacity = 0.38;

      const defs = document.createElementNS(svg.namespaceURI,"defs");
      const grad1 = document.createElementNS(svg.namespaceURI,"linearGradient");
      grad1.id = "nodeGrad";
      grad1.setAttribute("x1","0"); grad1.setAttribute("y1","0"); grad1.setAttribute("x2","1"); grad1.setAttribute("y2","1");
      const n1 = document.createElementNS(svg.namespaceURI,"stop"); n1.setAttribute("offset","0%"); n1.setAttribute("stop-color","#a3e635");
      const n2 = document.createElementNS(svg.namespaceURI,"stop"); n2.setAttribute("offset","100%"); n2.setAttribute("stop-color","#ec4899");
      grad1.append(n1,n2);

      const grad2 = document.createElementNS(svg.namespaceURI,"linearGradient");
      grad2.id = "lineGrad";
      grad2.setAttribute("x1","0"); grad2.setAttribute("y1","0"); grad2.setAttribute("x2","1"); grad2.setAttribute("y2","0");
      const l1 = document.createElementNS(svg.namespaceURI,"stop"); l1.setAttribute("offset","0%"); l1.setAttribute("stop-color","#84cc16");
      const l2 = document.createElementNS(svg.namespaceURI,"stop"); l2.setAttribute("offset","100%"); l2.setAttribute("stop-color","#f472b6");
      grad2.append(l1,l2);

      defs.append(grad1,grad2);
      svg.append(defs);

      for (const e of edges) {
        const line = document.createElementNS(svg.namespaceURI,"line");
        line.setAttribute("x1", e.x1); line.setAttribute("y1", e.y1);
        line.setAttribute("x2", e.x2); line.setAttribute("y2", e.y2);
        line.setAttribute("stroke","url(#lineGrad)");
        line.setAttribute("stroke-width","1");
        line.setAttribute("stroke-opacity", String(Math.max(0.08, 0.45 - (e.d / 150) * 0.45)));
        svg.append(line);
      }
      for (const n of nodes) {
        const g = document.createElementNS(svg.namespaceURI,"g");
        g.style.transformOrigin = \`\${n.x}px \${n.y}px\`;
        g.style.animation = \`driftNode \${n.dur}s ease-in-out \${n.delay}s infinite\`;
        g.style.setProperty("--dx", \`\${n.dx}px\`);
        g.style.setProperty("--dy", \`\${n.dy}px\`);

        const r1 = document.createElementNS(svg.namespaceURI,"rect");
        r1.setAttribute("x", n.x - n.s/2); r1.setAttribute("y", n.y - n.s/2);
        r1.setAttribute("width", n.s); r1.setAttribute("height", n.s); r1.setAttribute("rx","2");
        r1.setAttribute("fill","url(#nodeGrad)"); r1.setAttribute("opacity","0.95");
        const r2 = document.createElementNS(svg.namespaceURI,"rect");
        r2.setAttribute("x", n.x - n.s/2 + 10); r2.setAttribute("y", n.y - n.s/2 + 10);
        r2.setAttribute("width", n.s); r2.setAttribute("height", n.s); r2.setAttribute("rx","2");
        r2.setAttribute("fill","#00ff8850"); r2.setAttribute("opacity","0.25");
        g.append(r1,r2);
        svg.append(g);
      }
      bg.append(svg);
    }

    // ---------- Rendering ----------
    function render(entries) {
      // sort
      const enriched = entries.map(e => ({...e, ms: parseTimeToMs(e.timeInput)}));
      enriched.sort((a,b) => a.ms - b.ms);

      // leaderboard
      const list = document.getElementById("lbList");
      list.innerHTML = "";
      enriched.forEach((e,i) => {
        const li = document.createElement("li");
        li.className = "flex items-center justify-between py-3 rounded-xl px-2 transition hover:bg-white/5";
        const badge = ["ðŸ¥‡","ðŸ¥ˆ","ðŸ¥‰"][i] || "âœ¨";
        li.innerHTML = `
          <div class="flex items-center gap-3 min-w-0">
            <span class="inline-flex items-center justify-center w-7 h-7 shrink-0 rounded-md text-sm font-bold bg-gradient-to-b from-lime-400 to-pink-500 text-black shadow-[0_6px_20px_rgba(132,204,22,0.35)]">${badge}</span>
            <button class="text-left truncate hover:underline">
              <span class="font-medium">${e.name}</span>
              <span class="ml-2 text-xs text-white/50 hidden sm:inline">${hostOf(e.link)}</span>
            </button>
          </div>
          <span class="tabular-nums font-mono text-lg">${formatMs(e.ms)}</span>
        `;
        li.querySelector("button").addEventListener("click", () => setFeatured(enriched, i));
        list.append(li);
      });

      // default featured
      setFeatured(enriched, 0);
    }

    function setFeatured(list, idx) {
      const f = list[idx];
      const embed = document.getElementById("featuredEmbed");
      const metaWrap = document.getElementById("featuredMeta");
      const name = document.getElementById("featuredName");
      const link = document.getElementById("featuredLink");
      const time = document.getElementById("featuredTime");

      embed.innerHTML = "";
      if (!f) {
        embed.innerHTML = '<div class="w-full h-full flex items-center justify-center text-white/60">No submission selected</div>';
        metaWrap.classList.add("hidden");
        return;
      }
      // build embed
      let node = null;
      try {
        const u = new URL(f.link);
        const host = u.hostname.replace("www.","");
        if (host.includes("youtube.com") || host.includes("youtu.be")) {
          let id = u.searchParams.get("v"); if (!id && host.includes("youtu.be")) id = u.pathname.slice(1);
          if (id) {
            node = document.createElement("iframe");
            node.className = "w-full h-full rounded-2xl";
            node.src = "https://www.youtube.com/embed/"+id;
            node.title = "Submission video";
            node.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share";
            node.allowFullscreen = true;
          }
        } else if (host.includes("vimeo.com")) {
          const id = u.pathname.split("/").filter(Boolean)[0];
          if (id) {
            node = document.createElement("iframe");
            node.className = "w-full h-full rounded-2xl";
            node.src = "https://player.vimeo.com/video/"+id;
            node.title = "Submission video";
            node.allow = "autoplay; fullscreen; picture-in-picture";
            node.allowFullscreen = true;
          }
        } else if (u.pathname.endsWith(".mp4")) {
          node = document.createElement("video");
          node.className = "w-full h-full rounded-2xl";
          node.src = f.link; node.controls = true; node.playsInline = true;
        }
      } catch {}
      if (!node) {
        const a = document.createElement("a");
        a.href = f.link; a.target = "_blank"; a.rel = "noreferrer";
        a.className = "group flex items-center justify-center w-full h-full rounded-2xl border border-white/10 bg-white/5 hover:bg-white/10 transition";
        a.innerHTML = `
          <div class="text-center px-6 py-4">
            <p class="text-sm text-white/80">Open the submission on</p>
            <p class="text-lg font-semibold text-white mt-1 break-all group-hover:underline">${f.link}</p>
            <p class="mt-2 text-xs text-white/60">(Instagram, TikTok, X links open in a new tab)</p>
          </div>`;
        node = a;
      }
      embed.append(node);

      // meta
      name.textContent = f.name;
      link.textContent = f.link;
      time.textContent = formatMs(f.ms);
      metaWrap.classList.remove("hidden");
    }

    // ---------- Form ----------
    document.getElementById("submitForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const n = document.getElementById("name").value.trim();
      const t = document.getElementById("time").value.trim();
      const l = document.getElementById("link").value.trim();
      if (!n) return alert("Please add your name.");
      const ms = parseTimeToMs(t);
      if (!isFinite(ms)) return alert("Time must be like 01:02.450 or 45.3 seconds.");
      if (!l) return alert("Please add a public video link.");
      const list = loadEntries();
      list.push({ name: n, timeInput: t, link: l });
      saveEntries(list);
      // re-render
      render(list);
      // clear
      document.getElementById("name").value = "";
      document.getElementById("time").value = "";
      document.getElementById("link").value = "";
      // jump to top leaderboard
      window.scrollTo({ top: 0, behavior: "smooth" });
    });

    // ---------- Boot ----------
    initNodeNetBG();
    window.addEventListener("resize", () => {
      // debounce-ish: reinit after resize settles
      clearTimeout(window.__dripRSZ);
      window.__dripRSZ = setTimeout(initNodeNetBG, 150);
    });
    render(loadEntries());
  </script>
</body>
</html>
