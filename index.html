<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Drippy Magic Cube Challenge</title>
  <meta name="color-scheme" content="dark" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body { height: 100%; background: #070b10; }
    body { margin: 0; color: #fff; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji"; }

    /* helper animations */
    @keyframes floaty {0%{transform:translateY(0)}50%{transform:translateY(-6px)}100%{transform:translateY(0)}}
    @keyframes wobble {0%,100%{transform:rotate(0)}25%{transform:rotate(-3deg)}75%{transform:rotate(3deg)}}
    @keyframes marquee {0%{transform:translateX(0)}100%{transform:translateX(-50%)}}
    .animate-floaty{animation:floaty 4s ease-in-out infinite}
    .animate-wobble:hover{animation:wobble .6s ease-in-out}
    .animate-marquee{animation:marquee 16s linear infinite}

    /* bg node drift */
    @keyframes driftNode {
      0%   { transform: translate3d(0,0,0) rotate(0deg); opacity:.9 }
      50%  { transform: translate3d(var(--dx), var(--dy), 0) rotate(3deg); opacity:.95 }
      100% { transform: translate3d(0,0,0) rotate(0deg); opacity:.9 }
    }
  </style>
</head>
<body>
  <!-- LAYER 0: fractal cubes + lines (visible background) -->
  <div id="bg" aria-hidden="true"
       style="position:fixed; inset:0; z-index:0; pointer-events:none; overflow:hidden"></div>

  <!-- LAYER 1: translucent gradient overlay (lets BG show through) -->
  <div aria-hidden="true"
       style="
         position:fixed; inset:0; z-index:1; pointer-events:none;
         background:
           radial-gradient(1200px 600px at 15% 10%, rgba(255,255,255,0.06) 0, rgba(255,255,255,0) 60%),
           radial-gradient(900px 500px at 85% 15%, rgba(255,0,120,0.08) 0, rgba(255,0,120,0) 55%),
           linear-gradient(180deg, rgba(2,4,9,0.78), rgba(11,14,18,0.86));
       "></div>

  <!-- LAYER 2: content (transparent container so background is visible) -->
  <div style="position:relative; z-index:2; min-height:100vh;">
    <header class="relative">
      <div class="mx-auto max-w-6xl px-4 pt-10 pb-6">
        <div class="flex items-center gap-3">
          <img src="https://cdn.shopify.com/s/files/1/0630/6889/7494/files/eyes-3inch-red.png?v=1742844664"
               alt="Drippy Logo" class="w-12 h-12 object-contain animate-floaty animate-wobble" />
          <h1 class="text-2xl md:text-3xl font-extrabold tracking-tight bg-gradient-to-r from-lime-300 via-white to-pink-300 bg-clip-text text-transparent">
            Drippy Rubix Cube Leaderboard
          </h1>
        </div>
        <div class="mt-4 flex flex-wrap items-center gap-2">
          <span class="select-none rounded-xl bg-white/10 border border-white/10 px-3 py-1 text-xs font-semibold backdrop-blur">ðŸš€ SF startup polish</span>
          <span class="select-none rounded-xl bg-white/10 border border-white/10 px-3 py-1 text-xs font-semibold backdrop-blur">ðŸ’š Lime Ã— ðŸ’– Pink</span>
          <span class="select-none rounded-xl bg-white/10 border border-white/10 px-3 py-1 text-xs font-semibold backdrop-blur">ðŸ§© Speedrun vibes</span>
        </div>
        <p class="mt-3 max-w-2xl text-white/75">
          Sip, solve, send it. Post your best time and link your video from Instagram, TikTok, or X (Twitter).
          Fastest solves float to the topâ€”like fizz.
        </p>
      </div>
      <div class="mx-auto max-w-6xl px-4 pb-6">
        <div class="relative overflow-hidden rounded-2xl border border-white/10 bg-white/5 backdrop-blur">
          <div class="animate-marquee whitespace-nowrap py-2 text-sm">
            <span class="mx-6">ðŸ’š Lime x ðŸ’– Pink</span>
            <span class="mx-6">ðŸ§© Solve Fast</span>
            <span class="mx-6">ðŸ§  Smart Sips</span>
            <span class="mx-6">ðŸŽ¥ Link Your Clip</span>
            <span class="mx-6">ðŸš€ SF Startup Vibes</span>
          </div>
        </div>
      </div>
    </header>

    <main class="mx-auto max-w-6xl px-4 pb-24">
      <section class="grid grid-cols-1 lg:grid-cols-5 gap-6 items-stretch">
        <!-- Leaderboard -->
        <div class="lg:col-span-3 p-4 md:p-6 rounded-3xl bg-white/[0.06] backdrop-blur border border-white/10 shadow-[0_10px_40px_rgba(34,197,94,0.15)]">
          <div class="flex items-center justify-between">
            <h2 class="text-xl font-semibold">Top Times</h2>
            <span class="text-xs text-white/60">auto-sorted â€¢ lower is better</span>
          </div>
          <ol id="lbList" class="mt-4 divide-y divide-white/10"></ol>
        </div>

        <!-- Featured -->
        <div class="lg:col-span-2 p-4 md:p-6 rounded-3xl bg-white/[0.06] backdrop-blur border border-white/10 relative overflow-hidden">
          <div class="absolute -top-10 -right-10 w-40 h-40 rounded-full bg-gradient-to-tr from-lime-400/30 to-pink-500/30 blur-2xl"></div>
          <h2 class="text-xl font-semibold">Featured Clip</h2>
          <div class="mt-4 aspect-video w-full rounded-2xl overflow-hidden border border-white/10 bg-black/40" id="featuredEmbed">
            <div class="w-full h-full flex items-center justify-center text-white/60">No submission selected</div>
          </div>
          <div id="featuredMeta" class="mt-3 hidden items-center justify-between gap-2">
            <div class="min-w-0">
              <p id="featuredName" class="text-sm font-medium truncate"></p>
              <p id="featuredLink" class="text-xs text-white/60 truncate"></p>
            </div>
            <span id="featuredTime" class="text-sm font-mono tabular-nums bg-white/10 px-2 py-1 rounded-md"></span>
          </div>
        </div>
      </section>

      <!-- Submission -->
      <section id="submit" class="mt-10 p-4 md:p-6 rounded-3xl bg-white/[0.06] backdrop-blur border border-white/10 relative">
        <div class="flex items-center justify-between">
          <h3 class="text-lg md:text-xl font-semibold">Submit Your Time</h3>
          <span class="text-xs text-white/60">Demo stores locally</span>
        </div>
        <form id="submitForm" class="mt-5 grid grid-cols-1 md:grid-cols-12 gap-4">
          <div class="md:col-span-3">
            <label class="block text-sm text-white/70 mb-1">Name</label>
            <input id="name" placeholder="Your name" class="w-full rounded-xl bg-white/10 border border-white/10 px-3 py-2 outline-none focus:ring-2 focus:ring-lime-400/60" />
          </div>
          <div class="md:col-span-3">
            <label class="block text-sm text-white/70 mb-1">Time</label>
            <input id="time" placeholder="mm:ss.fff or seconds" class="w-full rounded-xl bg-white/10 border border-white/10 px-3 py-2 outline-none focus:ring-2 focus:ring-lime-400/60 font-mono" />
          </div>
          <div class="md:col-span-6">
            <label class="block text-sm text-white/70 mb-1">Video Link (Instagram, TikTok, X, YouTube, Vimeo, or .mp4)</label>
            <input id="link" placeholder="https://instagram.com/..." class="w-full rounded-xl bg-white/10 border border-white/10 px-3 py-2 outline-none focus:ring-2 focus:ring-lime-400/60" />
          </div>
          <div class="md:col-span-12 flex flex-wrap items-center gap-3">
            <button type="submit" class="rounded-xl px-5 py-2.5 font-semibold bg-gradient-to-r from-lime-400 via-emerald-400 to-pink-500 shadow-[0_10px_30px_rgba(132,204,22,0.35)] hover:scale-[1.02] hover:shadow-[0_12px_36px_rgba(236,72,153,0.45)] transition">Submit</button>
            <span class="text-xs text-white/60">By posting, you agree we can display your name + link.</span>
          </div>
        </form>
        <p class="mt-4 text-xs text-white/60">
          Pro tip: paste raw seconds like <span class="font-mono">41.82</span> or formatted like <span class="font-mono">01:02.450</span>.
          We auto-embed YouTube/Vimeo; socials open in a new tab.
        </p>
      </section>

      <footer class="relative mt-12 py-10">
        <div class="mx-auto max-w-6xl px-4">
          <div class="rounded-3xl border border-white/10 bg-white/[0.06] backdrop-blur p-6 flex flex-col md:flex-row items-center justify-between gap-4 overflow-hidden">
            <div>
              <h4 class="text-lg font-semibold">Want to win the grand prize?</h4>
              <p class="text-white/70 text-sm mt-1 max-w-xl">The more videos you post the better your chances, you dont have to have the high score to win. Every month we will be picking winners at random including one grand prize monthly winner.</p>
            </div>
            <a href="#submit" class="rounded-2xl px-5 py-2.5 font-semibold bg-gradient-to-r from-lime-400 via-emerald-400 to-pink-500 shadow-[0_10px_30px_rgba(132,204,22,0.35)] hover:opacity-95">Start Now</a>
          </div>
        </div>
      </footer>
    </main>
  </div>

  <noscript>This app needs JavaScript enabled.</noscript>

  <script>
    /* ===================== Utilities & Leaderboard ===================== */
    const pad = (n, len=2) => String(n).padStart(len, "0");
    function parseTimeToMs(str) {
      if (!str) return Number.POSITIVE_INFINITY;
      const s = String(str).trim();
      if (/^\d+(\.\d+)?$/.test(s)) return Math.round(parseFloat(s) * 1000);
      const parts = s.split(":").map(Number);
      if (parts.some((p) => isNaN(p))) return Number.POSITIVE_INFINITY;
      if (parts.length === 2) {
        const [mm, secRaw] = parts;
        const [ss, frac] = String(secRaw).split(".");
        return (mm * 60 + Number(ss)) * 1000 + (frac ? Math.round(Number("0."+frac) * 1000) : 0);
      }
      if (parts.length === 3) {
        const [hh, mm, ss] = parts;
        return ((hh * 3600) + (mm * 60) + ss) * 1000;
      }
      return Number.POSITIVE_INFINITY;
    }
    function formatMs(ms) {
      if (!isFinite(ms) || ms < 0) return "--:--";
      const totalSec = Math.floor(ms / 1000);
      const msec = ms % 1000;
      const mm = Math.floor(totalSec / 60);
      const ss = totalSec % 60;
      return `${pad(mm)}:${pad(ss)}.${pad(msec, 3)}`;
    }
    function hostOf(url) {
      try { return new URL(url).hostname.replace("www.",""); } catch { return ""; }
    }

    const STORAGE_KEY = "drippy_rubix_entries";
    const seedEntries = [
      { name: "Nova",      timeInput: "00:43.127", link: "https://youtu.be/dQw4w9WgXcQ" },
      { name: "Ry L.",     timeInput: "41.8",      link: "https://www.instagram.com/" },
      { name: "PixelPete", timeInput: "01:02.45",  link: "https://www.tiktok.com/" },
    ];
    function loadEntries() {
      try { const raw = localStorage.getItem(STORAGE_KEY); if (raw) return JSON.parse(raw); } catch {}
      return seedEntries;
    }
    function saveEntries(list) {
      try { localStorage.setItem(STORAGE_KEY, JSON.stringify(list)); } catch {}
    }

    function render(entries) {
      const enriched = entries.map(e => ({...e, ms: parseTimeToMs(e.timeInput)})).sort((a,b)=>a.ms-b.ms);
      const list = document.getElementById("lbList");
      list.innerHTML = "";
      enriched.forEach((e,i) => {
        const li = document.createElement("li");
        li.className = "flex items-center justify-between py-3 rounded-xl px-2 transition hover:bg-white/5";
        const medal = ["ðŸ¥‡","ðŸ¥ˆ","ðŸ¥‰"][i] || "âœ¨";
        li.innerHTML = `
          <div class="flex items-center gap-3 min-w-0">
            <span class="inline-flex items-center justify-center w-7 h-7 shrink-0 rounded-md text-sm font-bold bg-gradient-to-b from-lime-400 to-pink-500 text-black shadow-[0_6px_20px_rgba(132,204,22,0.35)]">${medal}</span>
            <button class="text-left truncate hover:underline">
              <span class="font-medium">${e.name}</span>
              <span class="ml-2 text-xs text-white/60 hidden sm:inline">${hostOf(e.link)}</span>
            </button>
          </div>
          <span class="tabular-nums font-mono text-lg">${formatMs(e.ms)}</span>
        `;
        li.querySelector("button").addEventListener("click", () => setFeatured(enriched, i));
        list.append(li);
      });
      setFeatured(enriched, 0);
    }

    function setFeatured(list, idx) {
      const f = list[idx];
      const embed = document.getElementById("featuredEmbed");
      const metaWrap = document.getElementById("featuredMeta");
      const name = document.getElementById("featuredName");
      const link = document.getElementById("featuredLink");
      const time = document.getElementById("featuredTime");

      embed.innerHTML = "";
      if (!f) {
        embed.innerHTML = '<div class="w-full h-full flex items-center justify-center text-white/60">No submission selected</div>';
        metaWrap.classList.add("hidden");
        return;
      }
      let node = null;
      try {
        const u = new URL(f.link);
        const host = u.hostname.replace("www.","");
        if (host.includes("youtube.com") || host.includes("youtu.be")) {
          let id = u.searchParams.get("v"); if (!id && host.includes("youtu.be")) id = u.pathname.slice(1);
          if (id) {
            node = document.createElement("iframe");
            node.className = "w-full h-full rounded-2xl";
            node.src = "https://www.youtube.com/embed/"+id;
            node.title = "Submission video";
            node.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share";
            node.allowFullscreen = true;
          }
        } else if (host.includes("vimeo.com")) {
          const id = u.pathname.split("/").filter(Boolean)[0];
          if (id) {
            node = document.createElement("iframe");
            node.className = "w-full h-full rounded-2xl";
            node.src = "https://player.vimeo.com/video/"+id;
            node.title = "Submission video";
            node.allow = "autoplay; fullscreen; picture-in-picture";
            node.allowFullscreen = true;
          }
        } else if (u.pathname.endsWith(".mp4")) {
          node = document.createElement("video");
          node.className = "w-full h-full rounded-2xl";
          node.src = f.link; node.controls = true; node.playsInline = true;
        }
      } catch {}
      if (!node) {
        const a = document.createElement("a");
        a.href = f.link; a.target = "_blank"; a.rel = "noreferrer";
        a.className = "group flex items-center justify-center w-full h-full rounded-2xl border border-white/10 bg-white/5 hover:bg-white/10 transition";
        a.innerHTML = `
          <div class="text-center px-6 py-4">
            <p class="text-sm text-white/80">Open the submission on</p>
            <p class="text-lg font-semibold text-white mt-1 break-all group-hover:underline">${f.link}</p>
            <p class="mt-2 text-xs text-white/60">(Instagram, TikTok, X links open in a new tab)</p>
          </div>`;
        node = a;
      }
      embed.append(node);
      name.textContent = f.name;
      link.textContent = f.link;
      time.textContent = formatMs(f.ms);
      metaWrap.classList.remove("hidden");
    }

    document.getElementById("submitForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const n = document.getElementById("name").value.trim();
      const t = document.getElementById("time").value.trim();
      const l = document.getElementById("link").value.trim();
      if (!n) return alert("Please add your name.");
      const ms = parseTimeToMs(t);
      if (!isFinite(ms)) return alert("Time must be like 01:02.450 or 45.3 seconds.");
      if (!l) return alert("Please add a public video link.");
      const list = loadEntries();
      list.push({ name: n, timeInput: t, link: l });
      saveEntries(list);
      render(list);
      document.getElementById("name").value = "";
      document.getElementById("time").value = "";
      document.getElementById("link").value = "";
      window.scrollTo({ top: 0, behavior: "smooth" });
    });

    /* ===================== Fractal Background ===================== */
    function initFractalCubeBG() {
      const bg = document.getElementById("bg");
      if (!bg) return;
      bg.innerHTML = "";

      const W = Math.max(640, window.innerWidth || 1280);
      const H = Math.max(480, window.innerHeight || 720);

      // target node count -> ensures you SEE something, even on small screens
      const TARGET_MIN = 90;
      const TARGET_MAX = Math.max(220, Math.min(420, Math.floor((W * H) / 12000)));

      const SCALE   = 0.0032;   // noise scale
      const OCTAVES = 4;        // fbm octaves
      const STEP    = 34;       // sampling step (smaller = more samples)
      const LINE_R  = 130;      // intra-cluster link radius
      const CLUSTS  = 6;        // cluster bands
      const svgNS   = "http://www.w3.org/2000/svg";

      const smooth = (t) => t * t * (3 - 2 * t);
      const lerp = (a, b, t) => a + (b - a) * t;

      function hashInt(x, y, seed) {
        let h = (x * 374761393) ^ (y * 668265263) ^ seed;
        h = (h ^ (h >>> 13)) >>> 0;
        h = (h * 1274126177) >>> 0;
        return (h & 0xffffffff) / 0x100000000;
      }
      function valueNoise(x, y, seed) {
        const x0 = Math.floor(x), y0 = Math.floor(y);
        const x1 = x0 + 1,        y1 = y0 + 1;
        const tx = smooth(x - x0), ty = smooth(y - y0);
        const v00 = hashInt(x0, y0, seed);
        const v10 = hashInt(x1, y0, seed);
        const v01 = hashInt(x0, y1, seed);
        const v11 = hashInt(x1, y1, seed);
        const ix0 = lerp(v00, v10, tx);
        const ix1 = lerp(v01, v11, tx);
        return lerp(ix0, ix1, ty);
      }
      function fbm(x, y, seed) {
        let f = 1, amp = 0.5, sum = 0, norm = 0;
        for (let o = 0; o < OCTAVES; o++) {
          sum  += valueNoise(x * f, y * f, seed + o * 101) * amp;
          norm += amp; f *= 2; amp *= 0.5;
        }
        return sum / norm;
      }
      function grad(x, y, seed) {
        const eps = 1.5;
        const a = fbm(x + eps, y, seed);
        const b = fbm(x - eps, y, seed);
        const c = fbm(x, y + eps, seed);
        const d = fbm(x, y - eps, seed);
        return { gx: (a - b), gy: (c - d) };
      }

      const seed = (W ^ H ^ 1337) >>> 0;

      function buildNodes(threshold) {
        const nodes = [];
        for (let y = 0; y < H; y += STEP) {
          for (let x = 0; x < W; x += STEP) {
            const jx = x + Math.random() * STEP;
            const jy = y + Math.random() * STEP;
            const nx = jx * SCALE, ny = jy * SCALE;
            const d  = fbm(nx, ny, seed);
            if (d > threshold) {
              const sz = 3 + Math.floor((d - threshold) * 48);
              const { gx, gy } = grad(nx, ny, seed);
              const mag = 6 + (d - threshold) * 28;
              const dx = gx * mag, dy = gy * mag;
              const delay = Math.random() * 1.6;
              const dur   = 7 + Math.random() * 10;
              const cid = Math.min(CLUSTS - 1, Math.floor(d * CLUSTS));
              nodes.push({ x: jx, y: jy, s: sz, cid, dx, dy, delay, dur, d });
            }
          }
        }
        nodes.sort((a, b) => b.d - a.d);
        return nodes;
      }

      // Adaptive thresholding so we always get enough nodes
      let thresholds = [0.60, 0.56, 0.52, 0.48, 0.44];
      let nodes = [];
      for (const th of thresholds) {
        nodes = buildNodes(th);
        if (nodes.length >= TARGET_MIN) break;
      }
      if (nodes.length > TARGET_MAX) nodes.length = TARGET_MAX;

      // If STILL too few (tiny screens), add some random sprinkles
      while (nodes.length < TARGET_MIN) {
        nodes.push({
          x: Math.random() * W, y: Math.random() * H,
          s: 5 + Math.random() * 16, cid: Math.floor(Math.random() * CLUSTS),
          dx: (Math.random() - 0.5) * 20, dy: (Math.random() - 0.5) * 20,
          delay: Math.random() * 1.6, dur: 7 + Math.random() * 10, d: 1
        });
      }

      // Group & edges
      const clusters = Array.from({ length: CLUSTS }, () => []);
      nodes.forEach(n => clusters[n.cid].push(n));

      const edges = [];
      for (const group of clusters) {
        for (let i = 0; i < group.length; i++) {
          for (let j = i + 1; j < group.length; j++) {
            const a = group[i], b = group[j];
            const dx = a.x - b.x, dy = a.y - b.y;
            const dist = Math.hypot(dx, dy);
            if (dist <= LINE_R) edges.push({ x1: a.x, y1: a.y, x2: b.x, y2: b.y, d: dist });
          }
        }
      }

      const centroids = clusters
        .filter(g => g.length)
        .map((g, idx) => {
          const c = g.reduce((acc, p) => (acc.x += p.x, acc.y += p.y, acc), { x: 0, y: 0 });
          return { x: c.x / g.length, y: c.y / g.length, cid: idx, n: g.length };
        });

      const centroidEdges = [];
      for (let i = 0; i < centroids.length; i++) {
        const a = centroids[i];
        const nbrs = centroids
          .map((b, j) => (j === i ? null : { j, d: Math.hypot(a.x - b.x, a.y - b.y) }))
          .filter(Boolean).sort((p, q) => p.d - q.d).slice(0, 3);
        for (const n of nbrs) {
          const b = centroids[n.j];
          centroidEdges.push({ x1: a.x, y1: a.y, x2: b.x, y2: b.y, d: n.d });
        }
      }

      // ==== SVG build ====
      const svg = document.createElementNS(svgNS, "svg");
      svg.setAttribute("viewBox", `0 0 ${W} ${H}`);
      svg.setAttribute("preserveAspectRatio", "none");
      svg.setAttribute("class", "w-full h-full");
      svg.style.opacity = 0.46;

      const defs = document.createElementNS(svgNS, "defs");
      const gTop = document.createElementNS(svgNS, "linearGradient");
      gTop.id = "cubeTop"; gTop.setAttribute("x1","0"); gTop.setAttribute("y1","0"); gTop.setAttribute("x2","1"); gTop.setAttribute("y2","1");
      gTop.innerHTML = `<stop offset="0%" stop-color="#a3e635"/><stop offset="100%" stop-color="#ec4899"/>`;

      const gSideL = document.createElementNS(svgNS, "linearGradient");
      gSideL.id = "cubeSideL"; gSideL.setAttribute("x1","1"); gSideL.setAttribute("y1","0"); gSideL.setAttribute("x2","0"); gSideL.setAttribute("y2","1");
      gSideL.innerHTML = `<stop offset="0%" stop-color="#22c55e"/><stop offset="100%" stop-color="#f472b6"/>`;

      const gSideR = document.createElementNS(svgNS, "linearGradient");
      gSideR.id = "cubeSideR"; gSideR.setAttribute("x1","0"); gSideR.setAttribute("y1","0"); gSideR.setAttribute("x2","1"); gSideR.setAttribute("y2","1");
      gSideR.innerHTML = `<stop offset="0%" stop-color="#84cc16"/><stop offset="100%" stop-color="#fb7185"/>`;

      const gLine = document.createElementNS(svgNS, "linearGradient");
      gLine.id = "lineGrad"; gLine.setAttribute("x1","0"); gLine.setAttribute("y1","0"); gLine.setAttribute("x2","1"); gLine.setAttribute("y2","0");
      gLine.innerHTML = `<stop offset="0%" stop-color="#84cc16"/><stop offset="100%" stop-color="#f472b6"/>`;

      const filter = document.createElementNS(svgNS, "filter");
      filter.id = "softGlow";
      filter.innerHTML = `
        <feGaussianBlur in="SourceGraphic" stdDeviation="2.2" result="blur"/>
        <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
      `;

      defs.append(gTop, gSideL, gSideR, gLine, filter);
      svg.append(defs);

      // inter-cluster links (faint)
      for (const e of centroidEdges) {
        const line = document.createElementNS(svgNS, "line");
        line.setAttribute("x1", e.x1); line.setAttribute("y1", e.y1);
        line.setAttribute("x2", e.x2); line.setAttribute("y2", e.y2);
        line.setAttribute("stroke", "url(#lineGrad)");
        line.setAttribute("stroke-width", "1.1");
        line.setAttribute("stroke-opacity", "0.12");
        svg.append(line);
      }

      // intra-cluster links
      for (const e of edges) {
        const line = document.createElementNS(svgNS, "line");
        line.setAttribute("x1", e.x1); line.setAttribute("y1", e.y1);
        line.setAttribute("x2", e.x2); line.setAttribute("y2", e.y2);
        line.setAttribute("stroke", "url(#lineGrad)");
        line.setAttribute("stroke-width", "1");
        const alpha = Math.max(0.08, 0.35 - (e.d / LINE_R) * 0.35);
        line.setAttribute("stroke-opacity", String(alpha));
        svg.append(line);
      }

      function cubeGroup(n) {
        const g = document.createElementNS(svgNS, "g");
        g.style.transformOrigin = `${n.x}px ${n.y}px`;
        g.style.animation = `driftNode ${n.dur}s ease-in-out ${n.delay}s infinite`;
        g.style.setProperty("--dx", `${n.dx}px`);
        g.style.setProperty("--dy", `${n.dy}px`);
        g.setAttribute("filter", "url(#softGlow)");
        const a = n.s, b = n.s * 0.55;

        const top = document.createElementNS(svgNS, "polygon");
        top.setAttribute("points", [
          `${n.x},${n.y - a}`,
          `${n.x + a},${n.y - b}`,
          `${n.x},${n.y}`,
          `${n.x - a},${n.y - b}`,
        ].join(" "));
        top.setAttribute("fill", "url(#cubeTop)");
        top.setAttribute("opacity", "0.95");

        const right = document.createElementNS(svgNS, "polygon");
        right.setAttribute("points", [
          `${n.x + a},${n.y - b}`,
          `${n.x + a},${n.y + b}`,
          `${n.x},${n.y + a}`,
          `${n.x},${n.y}`,
        ].join(" "));
        right.setAttribute("fill", "url(#cubeSideR)");
        right.setAttribute("opacity", "0.80");

        const left = document.createElementNS(svgNS, "polygon");
        left.setAttribute("points", [
          `${n.x - a},${n.y - b}`,
          `${n.x},${n.y}`,
          `${n.x},${n.y + a}`,
          `${n.x - a},${n.y + b}`,
        ].join(" "));
        left.setAttribute("fill", "url(#cubeSideL)");
        left.setAttribute("opacity", "0.85");

        g.append(left, right, top);
        return g;
      }

      nodes.forEach(n => svg.append(cubeGroup(n)));
      bg.append(svg);
    }

    /* ===================== Boot ===================== */
    initFractalCubeBG();
    window.addEventListener("resize", () => {
      clearTimeout(window.__dripRSZ);
      window.__dripRSZ = setTimeout(initFractalCubeBG, 150);
    });
    render(loadEntries());
    console.log("DrippyCubeChallenge fractal background: OK");
  </script>
</body>
</html>
